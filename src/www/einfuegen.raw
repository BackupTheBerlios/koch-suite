<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>

<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <link rev="made" href="mailto:michael@zaphod.rhein-neckar.de">
  <title>Koch-Suite - Rezept einf&uuml;gen</title>
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <!-- $Id: einfuegen.raw,v 1.3 2001/01/15 10:06:09 michael Exp $ -->

  <script language="JavaScript1.2">
  <!--
    function kat() {
      foo = "kategorien.php?target=kategorie&maxsel=5";
      window.open(foo, 'kat', 'width=300,height=400,scrollbars=yes');
    }
  //-->
  </script>
</head>

<body>
<a name="top"></a>
<h1><img src="pics/title.gif" alt="WWW-Kochbuch"></h1>

<table border=0 cellpadding="3" cellspacing="1">
<tr>
  <td valign="top">
    <? include "./menue.inc"; ?>
  </td>
  <td>
    <!-- Rechts: Ausgabe -->
  <?
    require "<%%PHP_LIBS%%>/functions.inc";

    if (isset($submit)) {
      // Titel ist gesetzt -> Formular auswerten

      $zutat = array();

      foreach ($zutaten as $z) {
        /* $zutaten ist ein Array, dass aus einzelnen Zutatenlisten
         * besteht.
         */

        $ingredients = array();

        foreach (split("[\r]?\n", trim($z)) as $line) {
          // Jede Zutatenliste wird in ihre einzelnen Zeilen aufgespalten

          $line = stripslashes($line);
          if ($line != '') { 
            // Nur nicht-leere Zeilen beachten

            $a = explode(" ", $line, 3); 
            /* Jede Zeile wird jetzt in ihre einzelnen Wörter zerlegt. */
  
            $i = 0;
            if (is_numeric($a[$i])) {
              $quant = array_shift($a);
            } 
            if (is_unit($a[$i])) { 
              $unit = array_shift($a);
            }
            $ingred = implode(" ", $a);
  
            array_push ($ingredients, array ("quant"  => $quant, 
                                             "unit"   => $unit,
                                             "ingred" => $ingred));
          }
          $quant  = '';
          $unit   = '';
          $ingred = '';
        }

        array_push ($zutat, array("title" => "Zutaten:", 
                                  "ingredients" => $ingredients));

      }

      $r = array ("title" => trim(stripslashes($titel)), 
                  "yield" => trim(stripslashes($portionen)),
                  "category" => split(',[ ]*', $kategorie),
                  "zutaten" => $zutat,
                  "anleitung" => $anweisung);

      echo "<pre>\n";
      echo mmexport(&$r);
      echo "</pre>\n";
    } else {
      // Titel ist nicht gesetzt -> Leerformular anzeigen.
  ?>
    <h2>Rezept in die Datenbank aufnehmen</h2>

    <form action="<? echo $PHP_SELF; ?>" method="post">
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td>Titel:</td>
        <td><input type="text" name="titel" value="<? echo $titel ?>"size="60"></td>
      </tr>
      <tr>
        <td>Portionen:</td>
        <td><input type="text" name="portionen" value="<? echo $portionen ?>"size="60"></td>
      </tr>
      <tr>
        <td><a href="kategorien.php?target=kategorie&maxsel=5" target="kat" onClick="kat();">Kategorien</a>:</td>
        <td><input type="text" name="kategorie" value="<? echo $kategorie ?>" size="60"></td>
      </tr>
      <tr>
        <td>Zutaten:</td>
        <td><textarea cols="60" rows="10" name="zutaten[0]" wrap="physical"><? echo $zutaten ?></textarea>
        </td>
      </tr>
      <tr>
        <td>Zubereitung:</td>
        <td><textarea cols="60" rows="10" name="anweisung" wrap="virtual"><? echo $anweisung; ?></textarea>
        </td>
      </tr>
    </table>
    <input type="submit" name="submit" value="Eintragen">
    <input type="reset" value="Formular L&ouml;schen">
    </form>

  <?
    }
  ?>

  </td>
</tr>
</table>

<hr noshade>
&copy; 2001 Michael Lestinsky 
&lt;<a href="mailto:michael@zaphod.rhein-neckar.de">michael@zaphod.rhein-neckar.de</a>&gt;.

</body>
</html>
