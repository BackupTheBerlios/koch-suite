<?php
  /* Copyright (c) 2001
   *      Michael Lestinsky. All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
   *    notice, this list of conditions and the following disclaimer.
   * 2. Redistributions in binary form must reproduce the above copyright
   *    notice, this list of conditions and the following disclaimer in the
   *    documentation and/or other materials provided with the distribution.
   * 3. All advertising materials mentioning features or use of this software
   *    must display the following acknowledgement:
   *      This product includes software developed by Michael Lestinsky.
   *
   * THIS SOFTWARE IS PROVIDED BY MICHAEL LESTINSKY ``AS IS'' AND
   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   * ARE DISCLAIMED.  IN NO EVENT SHALL MICHAEL LESTINSKY BE LIABLE
   * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
   * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
   * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
   * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
   * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
   * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
   * SUCH DAMAGE.
   */

  /**
   * Alias-Editor
   *
   * $Id: edit_alias.raw,v 1.11 2002/05/20 15:01:38 lestinsky Exp $
   * Edit the alias-list for a given unit.
   * @package WWW
   * @modulegroup Edit
   * @module edit_aliases
   */

  require_once "<%%PHP_LIBS%%>/setup.inc";
  require "<%%PHP_LIBS%%>/functions.inc";
  require "<%%PHP_LIBS%%>/lang.inc";
  require "<%%PHP_LIBS%%>/nocache.inc";
  include "<%%PHP_LIBS%%>/auth.inc";

  auth(WRITE);

  $error = '';
  $fwd   = '';

  /* Parse arguments */
  $unit = $_GET["unit"];
  if (empty($_POST["ALIASES"])) {
    $aliases = get_unit_aliases($unit);
  } else {
    $FORM_ALIASES = $_POST["ALIASES"];
    $aliases = split(",* +", $FORM_ALIASES);
  }
  if (isset($_SERVER["PHP_SELF"])) 
    $PHP_SELF = $_SERVER["PHP_SELF"];
  if (isset($_POST["SUBMIT"])) {
    if (delete_unit_alias($unit)) {
      foreach ($aliases as $alias) {
        if (($r = mk_unit_alias($unit, $alias)) >= 0) {
          /* Ok, go back. */
          $fwd = "<meta http-equiv=\"refresh\" content=\"0; URL=units.php\">";
        } else {
          /* Fehler. */;
          $error = "Error: $r";
        }
      }
    }
  }

?>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>

<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <link rev="made" href="mailto:michael@zaphod.rhein-neckar.de">
  <?php echo $fwd; ?>
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Koch-Suite</title>
  <!-- $Id: edit_alias.raw,v 1.11 2002/05/20 15:01:38 lestinsky Exp $ -->
  <style class="text/css">
  <!--
    .dark  { background-color:#c0c0d5; font-family:Helvetica,Arial; }
    .light { background-color:#e9e9f0; }
    .small { font-size:small; }
  //-->
  </style>
</head>

<body>
<h1><?php echo $Lang["Edit"] . ': ' . $unit; ?></h1>

<p>
[<a href="units.php"><? echo $Lang['Close'] ?></a>]
</p>

<p>
<?php
  echo "$error<br>\n";
  echo $Lang['Aliases']['DefDescr'];
?>
</p>

<form method=post action="<?php echo $PHP_SELF . "?unit=$unit"; ?>">
  <input type="text" value="<?php echo implode($aliases, " "); ?>" name="ALIASES"><br>
  <input type="submit" name="SUBMIT" value="<?php echo $Lang["FormApply"]; ?>">
  <input type="reset" value="<?php echo $Lang["FormReset"]; ?>"><br>
</form>

</body>
</html>

<?db_disconnect();?>
