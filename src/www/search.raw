<?
  /* Copyright (c) 2001
   *      Michael Lestinsky. All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
   *    notice, this list of conditions and the following disclaimer.
   * 2. Redistributions in binary form must reproduce the above copyright
   *    notice, this list of conditions and the following disclaimer in the
   *    documentation and/or other materials provided with the distribution.
   * 3. All advertising materials mentioning features or use of this software
   *    must display the following acknowledgement:
   *      This product includes software developed by Michael Lestinsky.
   *
   * THIS SOFTWARE IS PROVIDED BY MICHAEL LESTINSKY ``AS IS'' AND
   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   * ARE DISCLAIMED.  IN NO EVENT SHALL MICHAEL LESTINSKY BE LIABLE
   * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
   * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
   * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
   * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
   * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
   * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
   * SUCH DAMAGE.
   */

  require_once "<%%PHP_LIBS%%>/setup.inc";
  require "<%%PHP_LIBS%%>/functions.inc";
  require "<%%PHP_LIBS%%>/lang.inc";
  require "<%%PHP_LIBS%%>/nocache.inc";
  include "<%%PHP_LIBS%%>/auth.inc";

  auth(READ);

  session_register("searchresult");

?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>

<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <link rev="made" href="mailto:michael@zaphod.rhein-neckar.de">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Koch-Suite</title>
  <!-- $Id: search.raw,v 1.18 2002/05/26 22:17:19 lestinsky Exp $ -->
</head>

<body>
<a name="top"></a>
<h1><img src="pics/title.gif" alt="Koch-Suite"></h1>

<table border="0" cellpadding="3" cellspacing="0">
<tr>
  <td valign="top">
    <? include "./menue.inc"; ?>
  </td>
  <td>

    <?
      if (isset($HTTP_POST_VARS["where"]))
        $where = $HTTP_POST_VARS["where"];

      if (isset($HTTP_SERVER_VARS["PHP_SELF"]))
        $PHP_SELF = $HTTP_SERVER_VARS["PHP_SELF"];

      if (!empty($_POST["begriff"]) or !empty($_GET["all"])) {

        /* We have something to do, let's go: */
        ?>
        <h2><? echo $Lang['Search']['Result']; ?>:
          <? 
             if (empty($_GET["all"])) { 
               echo $_POST["begriff"];
             } 
          ?> 
        </h2>
    
        <table border=0>
        <?

        function  print_count(&$r) {
          global $Lang;

          echo "<tr><td colspan=\"2\">" . count($r) . " " .
                         $Lang['Search']['Hits'] . 
                   "</td></tr>\n";
          return true;
        }
    
        function print_titles($r) {
          $count = count($r);
          for ($i = 0; $i < $count; $i++) {
            $j = $i + 1;
            echo "<tr><td>$j</td>" .
                     "<td><a href=\"rezept.php?result_id=" . $i . "\">" . 
                     htmlentities($r[$i]["title"]) . "</a></td></tr>\n";
          }
        }

        /* Do the search */
        if (empty($where)) $where = 'title';
        if ($m = exec_search((isset($_POST["begriff"]) ? $_POST['begriff'] : ''), 
                             $where, 
                             (isset($_GET["all"]) ? $_GET["all"] : ''))) {
          print_count($m);
          print_titles($m);
          $_SESSION["searchresult"] = $m;

        } else {
          echo "<tr><td>" . $Lang['Search']['NoResult']. "</td></tr>\n";
        }
        ?>
        </table>
        <?
      }
    ?>
    <h2><? echo $Lang['Search']['Search']; ?></h2>
    <script language="JavaScript1.2">
      <!--
        function kat() {
          foo = "kategorien.php?target=begriff&maxsel=1";
          window.open(foo, 'kat', 'width=300,height=400,screenX=700,screenY=300, scrollbars=yes');
          document.forms[0].where.options[1].selected = true;
        }
      //-->
    </script>
   
    <form action="<? echo $PHP_SELF; ?>" method="post">
      <table border=0>
        <tr>
          <td><? echo $Lang['Search']['For']; ?></td>
          <td><input type="text" name="begriff">
        </tr>
        <tr>
          <td><? echo $Lang['Search']['In']; ?></td>
          <td><select name="where">
                <option value="title"><? echo $Lang['Search']['Menutitle']; ?></option>  
                <option value="cat"><? echo $Lang['Search']['Categories']; ?></option>
                <option value="ingred"><? echo $Lang['Search']['Ingredients']; ?></option>
                <option value="Source"><? echo $Lang['Source']; ?></option>
                <option value="Recorder"><? echo $Lang['Recorder']; ?></option>
              </select>
          </td>
        </tr>
      </table>
    <input type="submit" value="<? echo $Lang['Search']['Go']; ?>">
    <input type="reset" value="<? echo $Lang['Delete']; ?>">
    </form>
    <p>
      [<a href="<? echo "$PHP_SELF?all=1"; ?>"><? echo $Lang['AllRecipes']; ?></a>]
      [<a href="kategorien.php?target=begriff&maxsel=1" target="kat" onClick="kat();"><? echo $Lang['CatChoose']; ?></a>]
      <br>
      <a class="prop" href="<? echo "$PHP_SELF?all=a"; ?>">A</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=b"; ?>">B</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=c"; ?>">C</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=d"; ?>">D</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=e"; ?>">E</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=f"; ?>">F</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=g"; ?>">G</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=h"; ?>">H</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=i"; ?>">I</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=j"; ?>">J</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=k"; ?>">K</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=l"; ?>">L</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=m"; ?>">M</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=n"; ?>">N</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=o"; ?>">O</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=p"; ?>">P</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=q"; ?>">Q</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=r"; ?>">R</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=s"; ?>">S</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=t"; ?>">T</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=u"; ?>">U</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=v"; ?>">V</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=w"; ?>">W</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=x"; ?>">X</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=y"; ?>">Y</a>
      <a class="prop" href="<? echo "$PHP_SELF?all=z"; ?>">Z</a>
    </p>

  </td>
</tr>
</table>

<hr noshade>
&copy; 2001 Michael Lestinsky 
&lt;<a href="mailto:michael@zaphod.rhein-neckar.de">michael@zaphod.rhein-neckar.de</a>&gt;.
</body>
</html>
<?db_disconnect();?>
